
apiVersion: apps/v1
kind: Deployment
...
spec:
  ...
  template:
    ...
    spec:
      ...
      #============ Init containers ============
      initContainers:
        #---- php ----
        - name: init
          image: ...
          ...
          command:
            - ctools
            - init
          env:
            - name: CTOOLS_ROLE
              value: worker
            - name: DB_URL
              value: ...
            - name: DB_CA_CERT_URL
              value: ...
            ...
          volumeMounts:
            - mountPath: "/tmp"
              name: tmp
            ...

      #============ Containers ============
      containers:
        - name: worker
          image: ...
          imagePullPolicy: IfNotPresent
          env:
            - name: CTOOLS_ROLE
              value: worker
            - name: DB_URL
              value: ...
            ...
          volumeMounts:
            - mountPath: "/tmp"
              name: tmp
          lifecycle:
            preStop:
              exec:
                command: [ "ctools","stop"]
            ...

      volumes:
        - name: tmp
          emptyDir: {}
        ...
